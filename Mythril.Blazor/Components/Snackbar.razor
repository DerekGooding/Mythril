@inject Services.SnackbarService SnackbarService

<div class="snackbar-container">
    @if (visible)
    {
        <div class="snackbar @severity" key="@message">
            @message
        </div>
    }
</div>

@code {
    private string message = string.Empty;
    private string severity = "info";
    private bool visible;
    private bool isProcessing;

    protected override void OnInitialized()
    {
        SnackbarService.OnChange += ProcessQueue;
    }

    private async Task ProcessQueue()
    {
        if (isProcessing)
            return;

        isProcessing = true;

        while (SnackbarService.TryDequeue(out var item))
        {
            message = item.Message;
            severity = item.Severity;
            visible = true;
            StateHasChanged();

            await Task.Delay(3000); // show per message
            visible = false;
            StateHasChanged();

            await Task.Delay(250); // gap between snackbars
        }

        isProcessing = false;
    }

    public void Dispose()
    {
        SnackbarService.OnChange -= ProcessQueue;
    }
}
